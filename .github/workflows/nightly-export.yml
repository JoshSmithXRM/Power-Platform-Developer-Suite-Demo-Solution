# =============================================================================
# Nightly Export using PPDS-ALM
# =============================================================================
# Simplified example showing how to use ppds-alm reusable workflows.
#
# This workflow exports the solution from the Dev environment nightly,
# delegating the actual work to the ppds-alm shared workflow.
#
# Prerequisites:
#   - GitHub Environment 'Dev' configured with Dataverse credentials
#   - ppds-alm repository accessible
#
# For the full-featured export with noise filtering and versioning,
# see ci-export.yml which uses local composite actions.
# =============================================================================

name: 'Nightly Export (PPDS-ALM Example)'

on:
  # Nightly at 3 AM UTC (offset from ci-export.yml)
  schedule:
    - cron: '0 3 * * *'

  # Manual trigger
  workflow_dispatch:
    inputs:
      solution_name:
        description: 'Solution unique name'
        required: true
        default: 'PPDSDemo'

jobs:
  export:
    uses: joshsmithxrm/ppds-alm/.github/workflows/solution-export.yml@v1
    with:
      environment-url: ${{ vars.DATAVERSE_URL }}
      solution-name: ${{ github.event.inputs.solution_name || 'PPDSDemo' }}
      solution-folder: solutions/PPDSDemo/src
      target-branch: develop
    secrets:
      client-id: ${{ secrets.CLIENT_ID }}
      client-secret: ${{ secrets.CLIENT_SECRET }}
      tenant-id: ${{ secrets.TENANT_ID }}
