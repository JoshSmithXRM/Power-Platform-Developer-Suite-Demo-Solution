# =============================================================================
# Deploy to QA using PPDS-ALM
# =============================================================================
# Simplified example showing how to use ppds-alm reusable workflows.
#
# This workflow deploys the solution to the QA environment when the develop
# branch is updated, delegating the actual work to the ppds-alm shared workflow.
#
# Prerequisites:
#   - GitHub Environment 'QA' configured with Dataverse credentials
#   - ppds-alm repository accessible
#
# For the full-featured deployment, see cd-qa.yml which uses local
# composite actions and includes solution checking.
# =============================================================================

name: 'Deploy to QA (PPDS-ALM Example)'

on:
  # Deploy when develop branch is updated with solution changes
  push:
    branches:
      - develop
    paths:
      - 'solutions/PPDSDemo/src/**'

  # Manual trigger
  workflow_dispatch:

jobs:
  deploy:
    uses: joshsmithxrm/ppds-alm/.github/workflows/solution-deploy.yml@v1
    with:
      environment-name: QA
      environment-url: ${{ vars.DATAVERSE_URL }}
      solution-name: PPDSDemo
      solution-folder: solutions/PPDSDemo/src
    secrets:
      client-id: ${{ secrets.CLIENT_ID }}
      client-secret: ${{ secrets.CLIENT_SECRET }}
      tenant-id: ${{ secrets.TENANT_ID }}
